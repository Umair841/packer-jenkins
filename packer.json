pipeline{
    agent any
    options { 
     disableConcurrentBuilds() 
  }
    stages{
        stage("packerWork"){
            steps{
                script{
                        sh '''
                         DIR=$(pwd)
                         #sudo -S cp -r /home/ec2-user/packer $DIR/
                         ls
                         FILE=$DIR/packer
                         if [ -f "$FILE" ]; then
                              echo "we already have packer configured"
                         else 
                              sudo -S cp -r /home/ec2-user/packer $DIR/
                         fi
                           echo "lets bake AMI"
                         ./packer build  -var "Name=Hardened-AMI-"${env.BUILD_NUMBER}"" sample.json
                        '''
                }
            }
        }
    }
}
